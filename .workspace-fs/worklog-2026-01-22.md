### 作業ログ（2026-01-22）

#### 追加した依存関係
- `better-auth`
- `drizzle-orm`
- `drizzle-kit`（※マイグレーションの土台のみ。運用手順は未整備）
- `@libsql/client`（Turso接続）
- `@vercel/sandbox`（Vercel Sandbox SDK）

#### 追加した主要モジュール
- **環境変数**: `lib/env.ts`
- **DB接続**: `lib/db.ts`（`TURSO_DATABASE_URL` / `TURSO_AUTH_TOKEN`）
- **Auth**: `lib/auth.ts`, `lib/auth-client.ts`, `lib/auth-utils.ts`
  - Next.jsハンドラ: `app/api/auth/[...all]/route.ts`
- **App用スキーマ（暫定）**: `lib/schema/*`
  - `agents`, `conversations`, `messages`, `sandbox_instances`
- **Sandbox管理（最小）**: `lib/sandbox/manager.ts`

#### 追加したAPI（Route Handlers）
- **Agents**
  - `GET /api/agents`
  - `POST /api/agents`
  - `GET /api/agents/:id`
- **Conversations**
  - `GET /api/conversations`
  - `POST /api/conversations`（新規会話開始=Sandbox作成＋DBにsandboxId保存）
  - `GET /api/conversations/:id`
  - `GET /api/conversations/:id/messages`
  - `POST /api/conversations/:id/messages`（入力をSandboxで `bash -lc` 実行→messagesに保存）
  - `POST /api/conversations/:id/archive`（Sandbox停止＋Archived化）

#### UI（最小）
- ランディング: `app/page.tsx`（未ログインなら sign-in/up へ、ログイン済みは `/app` へ）
- Auth: `app/(auth)/sign-in`, `app/(auth)/sign-up`
- App: `app/(app)/layout.tsx`, `app/(app)/app/page.tsx`（/app）

#### 未対応/既知の穴
- **DBマイグレーション未整備**
  - BetterAuthのテーブル作成（BetterAuth CLI等）
  - App用テーブル作成（Drizzle Kit等）
- **Sandboxの成果物永続化なし**（方針通り。Archivedはチャット履歴のみ）
- **入力=シェル実行**はMVP用。今後はツール制限/ポリシーが必要

